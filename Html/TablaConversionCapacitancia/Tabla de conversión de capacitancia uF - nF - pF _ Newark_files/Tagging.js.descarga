//>>built
define("sudo/modules/Tagging",["dojo/_base/declare","dojo/dom","dojo/query","dojo/_base/array","sudo/modules/currency","dojo/request/script"],function(e,t,i,a,o,n){"use strict";return e(null,{afNetwork:null,observed:{addCart:!1},constructor:function(e,t){var i,a;if(this.isValid=!0,t=t||{},t.affiliatePageLabels=t.affiliatePageLabels||{},i={home:t.affiliatePageLabels.home||null,search:t.affiliatePageLabels.search||null,basket:t.affiliatePageLabels.basket||null,orderConf:t.affiliatePageLabels.orderConf||null,pdp:t.affiliatePageLabels.pdp||null,cms:t.affiliatePageLabels.cms||null,storefront:t.affiliatePageLabels.storefront||null,category:t.affiliatePageLabels.category||null},a=i[e],a||(this.isValid=!1),this.pageLabel=e,this._trackingIDs=t.trackingIDs||{},this.affilateURL=t.url||"",mk.tagging.pageData=mk.tagging.pageData||this.getPageData(e),mk.tagging.globalCurrencyCode="newark"!=mk.tagging.store?"GBP":"USD",mk.tagging.cookiePolicy=document.cookie.indexOf("cookieMessage")>-1,this.pageData=mk.tagging.pageData,this.affiliatePageLabel=a,this.currencyCode=o.currency,mk.tagging.observed=mk.tagging.observed||this.observed,!mk.tagging.observed.addCart){var n=this.observables.addToCart[mk.pageType]||null;n&&(mk.tagging.observed.addCart=n(this))}},observables:{publish:function(e,t){require(["dojo/topic"],function(i){var a="sudo/"+e;i.publish(a,t)})},addToCart:{search:function(e){return i("#sProdList .ajaxAddToCart").on("click",function(){var t,a,o,n,r,s={qty:void 0,mpn:void 0,ordercode:void 0,manufacturer:void 0};t=this.closest("tr"),t&&(a=i(".qty .input-control",t).attr("value")[0],o=i(".mftrPart a",t).attr("title")[0],n=i("p.sku a",t).attr("title")[0],r=i("td.description .hVal",t).attr("value")[0],s={qty:a,mpn:o,ordercode:n,manufacturer:r}),e.observables.publish("addCart",s)}),!0},pdp:function(e){return i("#product #addToOrder .ajaxAddToCart").on("click",function(){var t,a,o,n,r,s=mk.tagging.pageData.skus[0];t=i(".input-control",this.previousElementSibling).attr("value")[0],a=s.mpn,o=s.id,n=s.manufacturer,r={qty:t,mpn:a,ordercode:o,manufacturer:n},e.observables.publish("addCart",r)}),!0}}},getPageData:function(){if("pdp"==this.pageLabel)return this._tag.productDetail();if("search"==this.pageLabel)return this._tag.search(t.byId("sProdList"));if("basket"==this.pageLabel)return this._tag.shoppingCart(t.byId("order_details"));if("orderConf"==this.pageLabel){var e=pf.tagging.data.omniture.purchaseID||null;return this._tag.orderConfirmation(e)}return[]},_tag:{productDetail:function(){var e={id:"",mpn:"",manufacturer:"",ldjson:""};try{var t=i('script[type="application/ld+json"]'),a=t.map(function(e){return JSON.parse(i(e).text())}).filter(function(e){return e.manufacturer}).pop();e={id:a.sku,mpn:a.mpn,manufacturer:a.manufacturer.name,ldjson:a}}catch(e){}return{skus:[e]}},search:function(e){if(e){return{skus:i("tr:nth-child(-n+3) .sku",e).map(function(e){return{id:mk.helper.getInnerText(e)}})}}},shoppingCart:function(e){var t,a,n;if(e){return{skus:i("tbody tr:nth-child(-n+6)",e).map(function(e){if("cloned"!=e.id&&"addMoreLines"!=e.id)return t=mk.helper.getInnerText(i(".bnSku",e)[0]),a=mk.helper.getInnerText(i(".linePrice .priceCover",e)[0]),n=i(".qtyRule",e)[0].value||null,{id:t,price:o.parseCurrency(a),quantity:n}}).filter(function(e){return void 0!==e})}}},orderConfirmation:function(e){var t,a,n,r,s,l,d,u,h=[],c=0;if(e){a=pf.tagging.data.omniture.products.split("|").splice(4),a.length>0?(s=a[0].replace(/event31=/g,"")||0,l=a[1].replace(/event32=/g,"")||0):(n=dojo.byId("allItemTotal_price"),r=mk.helper.getInnerText(n),s=void 0,l=o.parseCurrency(r)||0),d=pf.tagging.data.omniture.products.replace(/^;|event.*|,/g,"").replace(/;$/g,""),u=d.split(";");for(var m=function(){for(var e=dojo.query("tbody tr","scheduleOrderTable"),t={},a=0,o=e.length;a<o;a+=1){var n=e[a],r=i(".descript dd",n).first().text(),s=i("td:nth-child(3) .ocLink",n).first().text(),l=i("td:nth-child(4)",n).first().text();t[s]={manufacturer:r,mpn:l}}return t}();c<u.length;){if(c+2<=u.length){t=u[c+2];var f={id:u[c],price:t,quantity:u[c+1]},p=m[f.id];p&&(f.mpn=p.mpn,f.manufacturer=p.manufacturer),h.push(f)}c+=3}return{skus:h,orderId:e,orderValue:{localCurrency:s,globalCurrency:l}}}}},loadAffiliate:function(e){n.get({url:e.url}).then(function(){e.sendData()})},createPixel:function(e){var t=document.createElement("img");t.src=e,t.width=1,t.height=1,t.style.display="none",document.body.appendChild(t)},createIframe:function(e){mk.helper.createIframe(e)},sendData:function(){}})});//# sourceMappingURL=Tagging.js.map